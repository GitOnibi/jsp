<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>

<c:choose>
	<c:when test="${ param.stu_name == null && param.dep_name ==null && param.stu_num == null }">
		<script type="text/javascript">alert("값을 모두 입력해 주세요");</script>
		<c:redirect url="stu_input.jsp">
			<c:param name="stu_name" value="${ param.stu_name }" />
			<c:param name="dep_name" value="${ param.dep_name }" />
			<c:param name="stu_num" value="${ param.stu_num }" />
		</c:redirect>
	</c:when>
	<c:when test="">
		<script type="text/javascript">alert("하나 이상의 과목을 체크하세요");</script>
		<c:redirect url="stu_input.jsp">
			<c:param name="stu_name" value="${ param.stu_name }" />
			<c:param name="dep_name" value="${ param.dep_name }" />
			<c:param name="stu_num" value="${ param.stu_num }" />
		</c:redirect>
	</c:when>
	<c:otherwise>
		<sql:query var="rs">
			SELET IDX FROM SCHOOL_STUDENT
		</sql:query>
		<c:if test="rs != null">
			SELECT max(IDX) AS mNum FROM SCHOOL_STUDENT
		</c:if>
		<c:forEach items="${ rs.rows }" var="row">
			<c:set var="IDX" value="${ row.mNum + 1 }" />
		</c:forEach>
		<sql:query var="rs">
			INSERT INTO SCHOOL_STUDENT(IDX, STU_NAME, DEP_NAME, STU_NUM) VALUES(?, ?, ?, ?);
			<sql:param value="${ IDX }" />
			<sql:param value="${ param.stu_name }" />
			<sql:param value="${ param.dep_name }" />
			<sql:param value="${ IDX }" />
		</sql:query>
	</c:otherwise>
</c:choose>