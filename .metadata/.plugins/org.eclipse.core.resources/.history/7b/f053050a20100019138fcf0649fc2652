<%@ page language="java" contentType="text/html; charset=UTF-8" pageEncoding="UTF-8" session="true"%>
<%@ taglib prefix="c" uri="http://java.sun.com/jsp/jstl/core" %>
<%@ taglib prefix="sql" uri="http://java.sun.com/jsp/jstl/sql" %>
<%@ taglib prefix="fmt" uri="http://java.sun.com/jsp/jstl/fmt" %>
<fmt:requestEncoding value="UTF-8" />
<%
	if(session.getAttribute("id") != null) {
		session.invalidate();
	} else {
%>
	<sql:query var="rs" dataSource="jdbc/OracleDB">
		SELECT * FROM test1 WHERE id=?
		<sql:param value="${ param.id }"/>
	</sql:query>
	<c:forEach items="${ rs.rows }" var="row">
		<c:set var="id" value="${ row.id }" />
		<c:choose>
			<when test="${param.pw == row.pw}">
				<c:set var="id" value="${param.id}" scope="session" />
			</when>
			<c:otherwise>
				<script type="text/javascript">
					alert("ì•„")
				</script>
			</c:otherwise>
		</c:choose>
	</c:forEach>

	
		String id = request.getParameter("id");
		String pw = request.getParameter("pw");
		
		String query = "SELECT * FROM test1";
		
		rs = stmt.executeQuery(query);
		while(rs.next()) {
			if( id.equals(rs.getString("id")) && pw.equals(rs.getString("pw")) ) {
				session.setAttribute("id", id);
				break;
			}
		}
<%
	}
%>
<script>
	location.href="ex04_login.jsp";
</script>